FROM liquibase/liquibase:4.25

# Create directory for JDBC drivers if it doesn't exist
USER root
RUN mkdir -p /liquibase/jdbc

# Download PostgreSQL JDBC driver
RUN apt-get update && \
    apt-get install -y wget && \
    wget https://jdbc.postgresql.org/download/postgresql-42.6.0.jar -O /liquibase/jdbc/postgresql-42.6.0.jar && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* && \
    chmod 644 /liquibase/jdbc/postgresql-42.6.0.jar

# Copy changelog files
COPY changelog/employee/changes /liquibase/changelog/employee/changes
COPY db.changelog-master.xml /liquibase/changelog/employee/

# Copy properties files
COPY ../liquibase-employee.properties /liquibase/liquibase-employee.properties

# Switch back to liquibase user for security
USER liquibase

# Set working directory
WORKDIR /liquibase